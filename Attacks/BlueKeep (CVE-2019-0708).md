---
tags:
  - attack
  - CVE
  - windows
date: 2023-09-1
---
- Critical RCE in RDP.
- Affects pre-Windows 8 and Windows Server 2008 R2 systems.
- Can be exploited without authentication.
# How It Works

- `Use-After-Free` bug in RDP's handling of the MS_T120 virtual channel before auth.
- Involves sending malformed PDU sequences to control kernel memory.
# Tools

- Available in [[Metasploit]]:
	- `use exploit/windows/rdp/cve_2019_0708_bluekeep_rce`
	- `set RHOSTS IP`
	- `set GROOMBASE`
	- `set GROOMSIZE`
	- `run`
- Many PoC tools available including [this one](https://github.com/Ekultek/BlueKeep/blob/master/bluekeep_poc.py).
# Detection

- Monitor unexpected RDP traffic prior to authentication attempts.
- Watch for TCP 3389 connections with no successful logon followed by crashes.
- Defender signals:
	- CISA and MS recommend enabling [[Network Level Authentication (NLA)]] and patching.
- Logging:
	- Windows Systems logs for RDP crashes (Event ID 1011).
	- Network devices: irregular RDP handshake attempts.
# Mitigation

- Apply MS patches.
- Enable NLA on all RDP endpoints.