---
tags:
 - SAP
---
A visual diagram below shows how the key SAP components fit together and how they communicate in a scenario explained below:

![[Pasted image 20250526013955.png]]

![[00-Attachments/SAP System Architecture|SAP System Architecture]]
# Real-World Examples

## Example 1

For example, a user wants to view their sales orders using a Fiori web application. The flow would appear as:

- User opens Fiori app called "My Sales Orders".
- App is just a web UI.

Then:

- App makes a web request (using OData) to the SAP system such as:

```bash
/sap/opu/odata/sap/ZSALES_ORDER_SRV/Orders?$filter=Customer eq '100000'
```

Next:

- SAP Gateway passes the request to the ABAP application server where processing happens.
- ABAP code runs in the background - maybe calling:
	- a BAPI like `BAPI_SALESORDER_GETLIST`.
	- A CDS view that pulls from tables like `VBAK` and `VBAP`.
- ABAP logic fetches the requested sales order data.

Finally:

- Logic is connected to real functional modules like SD (Sales and Distribution).
- Modules handle the business rules for retrieving and formatting sales order data.
- The system queries the database to retrieve the actual order data.
- Results travel back up the stack, through the ABAP layer -> SAP Gateway -> returned to the Fiori app.
## Example 2

>[!tldr] Summary
>When you click a button in Fiori, youâ€™re firing a REST API call (OData), which Gateway translates into ABAP method calls, which hit ERP logic in ECC or S/4, which query the database, and flow all the way back to update your UI.

For a more detailed example flow:
### Fiori App

- Frontend written in JS.
- Button click triggers a JS controller method like:

```js
oModel.read("/Orders", {
   filters: [new Filter("Customer", "EQ", "100000")],
   success: onSuccess,
   error: onError
});
```

- Generates a standard HTTP GET request to a URL like:

```bash
https://sap.company.com/sap/opu/odata/sap/ZSALES_ORDER_SRV/Orders?$filter=Customer eq '100000'
```
### Request Over the Network

- True REST request using OData.
- It uses:
	- HTTP GET
	- Headers for session cookies, CSRF tokens, etc..
	- query string for filters.
- Travels via TLS/SSL (HTTPS).
### SAP Gateway

- ABAP-based component (part of same S/4 system).
- Parses the OData request and maps it to:
	- OData service name (ZSALES_ORDER_SRV)
	- EntitySet (Orders)
	- Method type (GET_ENTITYSET)
	- Input params (Customer = '100000')
- Gateway runs inside AS ABAP but exposes a web facing entry point.
- It passes the request to a DPC and MPC.
	- standard ABAP classes generated from transaction SEGW.
### ABAP Runtime

- Request triggers a method like:

```abap
METHOD /iwbep/if_mgw_read_entityset~read_entityset.
  SELECT * FROM zsalesorder WHERE kunnr = '100000' INTO TABLE et_entityset.
ENDMETHOD.
```

- ABAP code executes inside the AS ABAP instance.
- Now in a work process on the app server.
- Memory allocated for session.
- Authorization checks are in place (via PFCG roles).
### Query Hits App Server

- Actual ERP layer (ECC or S/4 HANA)
- Business rules are applied.
- Customizing tables may be read for logic.
- Code might call standard function modules, BAPIs or CDS views.
### Database Access

- ABAP statement like:

```abap
SELECT * FROM vbak WHERE kunnr = '100000'.
```

- Sent through Open SQL interface.
	- DB-agnostic, but internally translated into native SQL.
- Query execution plan generated by HANA optimizer.
- Data returned in memory, often compressed.
- SAP fetches only the required columns.
### Return

- ðŸ”¼ From DB â†’ ABAP work process
	â†’ internal table (e.g., lt_orders) is filled
- ðŸ”¼ From ABAP â†’ DPC class
	â†’ table is transformed into OData response structure
- ðŸ”¼ From Gateway â†’ JSON/XML payload is generated
- ðŸ”¼ HTTP response is sent back to the userâ€™s browser
### UI Updated

- The OData response is parsed by the SAPUI5 model.
- The table control (e.g., sap.m.Table) is automatically updated.
- The user sees their sales orders rendered on screen.

| Layer              | Protocol / Tech Used        | Notes                                      |
| ------------------ | --------------------------- | ------------------------------------------ |
| Fiori UI (Browser) | SAPUI5, JavaScript, HTTPS   | Sends REST/OData request                   |
| Network            | HTTP/1.1 or HTTP/2 (TLS)    | Standard web traffic                       |
| Gateway            | OData handler, SEGW         | Converts HTTP to ABAP method call          |
| ABAP Stack         | ABAP Runtime                | Executes business logic, security checks   |
| ERP Logic (ECC/S4) | ABAP modules (SD, MM, etc.) | Applies rules, calls DB, reads customizing |
| Database           | Open SQL â†’ Native SQL       | HANA or other DB returns raw data          |
| Return Path        | JSON â†’ HTTP â†’ SAPUI5        | Response goes back to the browser frontend |
